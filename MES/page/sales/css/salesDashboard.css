/* page/sales/css/salesDashboard.css */

/* --- Default Mobile First (มือถือเลื่อนจอได้ปกติ) --- */
#main-content {
    height: auto; /* ปล่อยความสูงตามเนื้อหา */
    min-height: 100vh;
    overflow-y: auto; /* ให้เลื่อนลงได้ */
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    padding-bottom: 2rem; /* เผื่อที่ด้านล่างนิดหน่อย */
}

.content-wrapper {
    padding: 1rem;
    flex: 1;
}

.table-responsive-custom {
    /* บนมือถือ ให้ตารางมีความสูงระดับหนึ่งเพื่อให้เลื่อนแนวนอนได้ง่าย */
    min-height: 400px; 
    overflow-x: auto;
    border: 1px solid var(--bs-border-color);
    border-radius: 0.5rem;
    background-color: var(--bs-body-bg);
}

/* --- Desktop Layout (จอใหญ่กว่า 992px ล็อคหน้าจอ) --- */
@media (min-width: 992px) {
    #main-content {
        /* บังคับเต็มจอ หัก Header ออก */
        height: calc(100vh - 70px); 
        overflow: hidden !important; /* ห้าม Scroll หน้าหลัก */
    }

    .content-wrapper {
        /* ให้ Wrapper ยืดเต็มพื้นที่ที่เหลือ */
        flex: 1;
        overflow: hidden; 
        padding: 1rem !important;
        display: flex;
        flex-direction: column;
    }

    .card.table-card {
        /* การ์ดตารางยืดเต็ม */
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        margin-bottom: 0 !important;
    }

    .table-responsive-custom {
        /* ตารางยืดเต็มการ์ด และ Scroll ภายใน */
        flex: 1;
        height: 100% !important;
        overflow: auto;
    }
    
    /* บังคับ 5 ใบแถวเดียวเฉพาะ Desktop */
    .col-lg-20-percent {
        flex: 0 0 auto;
        width: 20%;
    }
}

/* --- Dark Theme Support & Consistency --- */

/* Sticky Header */
.dashboard-header-sticky {
    background-color: var(--bs-body-bg);
    border-bottom: 1px solid var(--bs-border-color);
    padding: 1rem;
    flex-shrink: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
}

/* Table Header & Sticky Column */
thead.sticky-top {
    position: static !important; /* ไม้ตายที่ 1 */
    z-index: auto !important;
}

thead.sticky-top th {
    position: sticky !important; /* ไม้ตายที่ 2 */
    top: 0 !important;           /* บังคับติดบน */
    z-index: 20;                 /* ชั้นล่าง */
}

/* Sticky Column (PO Number) */
.sticky-col {
    position: sticky;
    left: 0;
    z-index: 30 !important;
    background-color: var(--bs-body-bg) !important;
    color: var(--bs-body-color);
    border-right: 2px solid var(--bs-border-color) !important;
}

thead.sticky-top th.sticky-col {
    position: sticky !important;
    left: 0 !important;          /* ติดซ้าย */
    top: 0 !important;           /* ติดบน (สำคัญ!) */
    z-index: 40 !important;      /* ชั้นบนสุด */
    background-color: var(--bs-body-bg) !important; /* กันสีพื้นหลังทะลุ */
}

thead.sticky-top th[data-sort="is_confirmed"] {
    position: sticky !important;
    right: 0 !important;
    top: 0 !important;
    z-index: 35 !important;
    background-color: var(--bs-body-bg) !important;
}

thead.sticky-top th.ps-3.border-start {
    position: sticky;
    right: 0;
    top: 0;
    z-index: 35 !important;
    background-color: var(--bs-body-bg) !important;
}

/* Sorting Icons */
th.sortable {
    cursor: pointer;
    user-select: none;
    position: relative;
}
th.sortable:hover {
    background-color: var(--bs-border-color) !important; /* Hover effect */
}
th.sortable.active-sort .sort-icon {
    color: var(--bs-primary);
}
th.sortable .sort-icon {
    margin-left: 5px;
    font-size: 0.8em;
    color: var(--bs-secondary-color);
}

/* คอลัมน์ที่ 1: ปุ่มลาก (Drag Handle) */
/* ให้ติดซ้ายสุดที่ตำแหน่ง 0 */
td.sticky-col.start-0, 
th.sticky-col.start-0 {
    position: sticky !important;
    left: 0 !important;
    z-index: 50 !important;
    background-color: var(--bs-body-bg) !important;
    border-right: 1px solid var(--bs-border-color);
    width: 60px;
}

/* คอลัมน์ที่ 2: PO Number */
/* ต้องขยับ Sticky ไปทางขวาเท่ากับความกว้างของคอลัมน์แรก (60px) */
/* สังเกต class .ps-3 ที่ติดมากับ PO Number ใน JS ให้แก้เป็น class นี้แทน */
td.sticky-po,
th.sticky-po {
    position: sticky !important;
    left: 60px !important;
    z-index: 40 !important;
    background-color: var(--bs-body-bg) !important;
    border-right: 2px solid var(--bs-border-color);
}

/* แก้สีพื้นหลังตอน Hover หรือมีสีแถว (Confirmed/Late) ไม่ให้ทะลุ Sticky */
tr.row-confirmed td.sticky-col, tr.row-confirmed td.sticky-po { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(25, 135, 84, 0.15); }
tr.row-late td.sticky-col, tr.row-late td.sticky-po      { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(220, 53, 69, 0.15); }
tr.row-warning td.sticky-col, tr.row-warning td.sticky-po   { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(255, 193, 7, 0.15); }

/* Table Body */
table.table tbody td {
    font-size: 0.9rem;
    vertical-align: middle;
}

/* Row Hover Effect (Dark Mode Compatible) */
.table-hover > tbody > tr:hover > * {
    --bs-table-accent-bg: var(--bs-tertiary-bg);
    color: var(--bs-body-color);
}

/* Input Fields (Dark Mode Compatible) */
input.form-control, input.form-control-sm {
    background-color: var(--bs-body-bg);
    color: var(--bs-body-color);
    border-color: var(--bs-border-color);
}
input.form-control:focus {
    background-color: var(--bs-body-bg);
    color: var(--bs-body-color);
    box-shadow: none;
    border-color: var(--bs-primary);
}

/* KPI Cards */
.kpi-card {
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid var(--bs-border-color);
    background-color: var(--bs-body-bg); /* พื้นหลังเปลี่ยนตามธีม */
    height: 100%;
}
.kpi-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}
.kpi-card.active {
    background-color: rgba(13, 110, 253, 0.1) !important; /* สีฟ้าจางๆ โปร่งแสง */
    border: 2px solid #0d6efd;
}
/* ให้ตัวเลขในการ์ดเปลี่ยนสีตามธีม */
.kpi-card h2, .kpi-card .text-body-secondary {
    color: var(--bs-body-color); 
}

/* --- Status Colors (ใช้ rgba เพื่อให้เห็นพื้นหลังใน Dark Mode) --- */

/* 1. Confirmed (Green) */
tr.row-confirmed td {
    background-color: rgba(25, 135, 84, 0.15) !important;
    color: #0f5132 !important;
}
[data-bs-theme="dark"] tr.row-confirmed td {
    color: #75b798 !important; /* สีเขียวอ่อนสำหรับ Dark Mode */
}

/* 2. Late (Red) */
tr.row-late td {
    background-color: rgba(220, 53, 69, 0.15) !important;
    color: #842029 !important;
}
[data-bs-theme="dark"] tr.row-late td {
    color: #ea868f !important; /* สีแดงอ่อนสำหรับ Dark Mode */
}

/* 3. Warning (Yellow) */
tr.row-warning td {
    background-color: rgba(255, 193, 7, 0.15) !important;
    color: #664d03 !important;
}
[data-bs-theme="dark"] tr.row-warning td {
    color: #ffda6a !important; /* สีเหลืองอ่อนสำหรับ Dark Mode */
}

/* Fix Sticky Column Background for Colored Rows */
/* ต้องใช้ box-shadow ทับสีพื้นหลัง เพราะ td sticky ต้องมี background ทึบ */
tr.row-confirmed .sticky-col { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(25, 135, 84, 0.15); }
tr.row-late .sticky-col      { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(220, 53, 69, 0.15); }
tr.row-warning .sticky-col   { background-color: var(--bs-body-bg) !important; box-shadow: inset 0 0 0 9999px rgba(255, 193, 7, 0.15); }

/* Utilities */
.long-text-cell {
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

td.editable:hover {
    background-color: var(--bs-tertiary-bg) !important;
    cursor: text;
    outline: 1px dashed var(--bs-secondary);
}

/* --- Custom Colors (แก้ไขใหม่: สูตร Pastel สบายตา) --- */

/* นิยามสีม่วงลาเวนเดอร์ (ใช้สีตายตัวเลย ไม่ต้องพึ่ง Opacity แล้ว จะได้สีเป๊ะๆ) */
.bg-purple, 
.bg-purple.bg-opacity-10 { /* บังคับทับ class opacity ไปเลย */
    background-color: #e0cffc !important; /* สีพื้น: ม่วงอ่อนพาสเทล */
    color: #4c2f91 !important;            /* สีตัวอักษร: ม่วงเข้ม (ให้อ่านง่าย) */
}

/* นิยามสีตัวอักษรม่วง (เผื่อใช้ที่อื่น) */
.text-purple {
    color: #6f42c1 !important;
}

/* Checkbox ในพื้นที่สีม่วง (ปรับขอบให้เข้าธีม) */
.bg-purple .form-check-input {
    border-color: #bfa1f7;
}
.bg-purple .form-check-input:checked {
    background-color: #6f42c1;
    border-color: #6f42c1;
}

/* --- Dark Mode (ปรับให้มืดลง ไม่สว่างจ้าในที่มืด) --- */
[data-bs-theme="dark"] .bg-purple,
[data-bs-theme="dark"] .bg-purple.bg-opacity-10 {
    background-color: rgba(111, 66, 193, 0.2) !important; /* ม่วงโปร่งแสง 20% */
    color: #e0cffc !important; /* ตัวอักษรสีอ่อน */
    border-color: rgba(111, 66, 193, 0.3) !important; /* เส้นขอบ */
}